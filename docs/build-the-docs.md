# Building the Documentation

You're now ready to build (generate) the ownCloud documentation.
The documentation can be generated in HTML and PDF formats.

## Generating in HTML Format

There are two ways to generate the documentation in HTML format:

- Using the Official Docker Container
- Running Antora from the Command-Line

### Using the Docker Container

From the command line, in the root of the docs directory, run the command:

```
docker run -ti --rm \
    -v $(pwd):$(pwd) \
    -w $(pwd) \
    antora/antora:latest \
    generate site.yml
```

This command starts up the Antora Docker container, removes the existing documentation, and then runs Antora's generate command, an regenerates the documentation.
If all goes well, you will _not_ see any console output.

### Running Antora From The Command-Line

From the command line, in the root of the docs directory, run the command:

```
antora site.yml
```

If all goes well, you will _not_ see any console output.

### Viewing The HTML Documentation

Assuming that there are no errors, the next thing to do is to run the [NPM Serve tool](https://www.npmjs.com/package/serve) so that you can view your changes, before committing and pushing the changes to the remote docs repository.
We suggest using it, as it's trivial to install and start.
You could also use [PHP's built-in webserver](https://secure.php.net/manual/en/features.commandline.webserver.php) as well.
By using either of these, you don't have to install and configure a complete webserver, such as Apache or NGINX.

To start *Serve*, run the following command:

```
serve public &
```

This starts Serve and set it running in the background, using the `public` directory, (re)generated by `antora site.yml`, as the document root, listening on `http://localhost:5000`.
_The URL is automatically copied to the clipboard._

![Viewing the Antora docs with NPM serve](./images/viewing-the-antora-docs-with-npm-serve.png)

Open the URL in your browser of choice and you'll see two links, as below.

![The initial page in the local copy of the Antora-generated documentation](./images/antora-initial-local-page.png)

Click "**server/**", and you'll see the local copy of the documentation.

![Viewing the locally generated Antora documentation](./images/viewing-the-locally-generated-antora-documentation.png)

If you're happy with your changes, as with any other change, create a set of meaningful commits and push them to the remote repository.
If you're _not_ satisfied with the changes, however, continue to make further updates, as necessary, and run `antora site.yml` afterwards.
Your changes will be reflected in the local version of the site that Serve is rendering.

We hope that you can see that contributing to the documentation using Antora is a pretty straight-forward process, and not _that_ demanding.

## Generating in PDF Format

To generate the documentation in PDF format, you need to have `asciidoctor-pdf`, and GNU `make` installed.
To install asciidoctor-pdf, please refer to [the official installation instructions](https://asciidoctor.org/docs/asciidoctor-pdf/).
To install GNU Make, please refer to the link below for your operating system:

- [Linux](https://www.cyberciti.biz/faq/howto-installing-gnu-c-compiler-development-environment-on-ubuntu/)
- [macOS](http://brewformulas.org/Make)
- [Microsoft Windows](http://gnuwin32.sourceforge.net/install.html)

When installed, run the command below in the root directory of the repository, to generate the manuals.

```console
make pdf
```

The PDF files will be generated in the build directory, and will be named after the configuration file.
The build directory is called `build` and is located in the root of the repository.

The Make target invokes [asciidoctor-pdf](https://github.com/asciidoctor/asciidoctor-pdf), passing it:

1. **[The configuration file](https://github.com/asciidoctor/asciidoctor-pdf/blob/master/docs/theming-guide.adoc) to use** (*which you can find more details about below*).
  This contains the list of files to use as the PDF's source material, along with front-matter. The front-matter includes details such as whether to render a table of contents, the icon set to use, and the images base directory. See below for details on how to generate the initial configuration file, if it is missing.
2. **The custom theme directory and the custom theme file.**
  This ensures that the defaults are overridden, where relevant, to ensure that the generated PDF is as close to the current ownCloud style as possible.

### A Note About Custom Fonts

Please be aware that the custom ownCloud PDF theme references a custom font, *Times New Roman*, in place of the packaged Times Roman font, as Times Roman doesn't support a wide enough character set to render the manuals correctly.

If you have this font available on your system, you need to copy it (all four variants: _normal_, _italic_, _bold_, and _bold-italic_), to the `fonts` directory. If you don't, then you'll have to copy the closest matching font family to _Times New Roman_ that you do have, and then update `resources/themes/owncloud-theme.yml`.

If you want to use your available system fonts, here’s where you can find them:

| Operating System | Font Directory |
|---|---|
| [macOS](https://support.apple.com/en-bh/HT201749) | `/Library/Fonts` |
| [Linux](https://medium.com/source-words/how-to-manually-install-update-and-uninstall-fonts-on-linux-a8d09a3853b0) | `/usr/share/fonts/` or `~/.local/share/fonts` |
| [Windows](https://support.microsoft.com/en-us/help/314960/how-to-install-or-remove-a-font-in-windows) | `%windir%\fonts` |

Alternatively, you can use free fonts, available online from various font directories.
Two of the most well known are [Google Fonts](https://fonts.google.com/) and [Font Squirrel](https://www.fontsquirrel.com/).

### How To Generate The PDF Configuration File

Book file generation isn't currently supported by Antora.
As a result, it needs to be done separately.
To save time and effort, you can use [the Antora Tools Phar file](https://github.com/settermjd/antora-tools/releases/download/0.0.1/antora-tools.phar), written specifically for the ownCloud docs.
It provides a single command `antora:create-asciidoc-book-file`, which takes four options:

| Setting | Description |
|---|---|
| `nav-file`     | This is the name of an Antora navigation file. The links in this file are used as the PDF's source matter. The default is `nav.adoc`. |
| `book-file`    | This is the name of the PDF book file to generate from the contents of the Antora navigation file. The default is `book.adoc`. |
| `manual-name`  | This is the name of the manual. At this stage, one of "*Admin Manual*", "*Developer Manual*", or "*User Manual*" are what will be used. |
| `file-version` | This is the file's version. It should be the same as the version of the software that the manual's supporting. For example: `10.1.0`. |

Here’s an example of running it:

```console
php antora-tools.phar antora:create-asciidoc-book-file \
    --nav-file=modules/developer_manual/nav.adoc \
    --book-file=book.dev.adoc \
    --manual-name="ownCloud Developer Manual" \
    --file-version=0.0.1
```

**Note:** At the moment, [the images directory is hardcoded](https://github.com/settermjd/antora-tools/blob/master/src/AntoraTools/Command/GenerateAsciiDocBookFileCommand.php#L17) to `./public/`.
After the book file is changed, this setting needs to be updated to the manual’s image directory root.
For example, to set the image base directory of the developer manual, change it as in the example below.

```asciidoc
:imagesdir: ./public/server/developer_manual/_images/
```

## Viewing Build Errors

If an aspect of your change contains invalid AsciiDoc, then you'll see output similar to the example below.

```console
asciidoctor: ERROR: index.adoc: line 25: only book doctypes can contain level 0 sections
```

There, you can see:

- That an error was found
- The file it was found in
- The line of that file where it is located
